1. SELECT model, speed, hd FROM PC WHERE price < 500
2. SELECT DISTINCT  maker FROM Product WHERE type = 'Printer'
3. SELECT Product.model, Laptop.ram, Laptop.screen
FROM Product INNER JOIN Laptop
ON Product.model = Laptop.model WHERE Laptop.price > 1000
4. SELECT * FROM Printer WHERE color = 'y'
5. SELECT model, speed, hd 
FROM PC 
WHERE ((cd = '12x' OR cd = '24x') AND price < 600)
6. SELECT DISTINCT  Product.maker, Laptop.speed
FROM Product INNER JOIN Laptop
ON Product.model = Laptop.model WHERE Laptop.hd >= 10
7. SELECT Laptop.model, Laptop.price
FROM Product INNER JOIN Laptop
ON Product.model = Laptop.model WHERE Product.maker = 'B'
UNION
SELECT Printer.model, Printer.price
FROM Product INNER JOIN Printer
ON Product.model = Printer.model WHERE Product.maker = 'B'
UNION
SELECT PC.model, PC.price
FROM Product INNER JOIN PC
ON Product.model = PC.model WHERE Product.maker = 'B'
8. SELECT DISTINCT maker 
FROM product WHERE type='pc' and maker NOT IN
(SELECT maker FROM product WHERE type='laptop')
9. SELECT DISTINCT Product.maker
FROM Product INNER JOIN PC
ON Product.model = PC.model WHERE PC.speed >= 450
10. SELECT DISTINCT model, price
FROM Printer
WHERE price = (SELECT MAX(price) 
 FROM Printer
 )
11. SELECT AVG(speed) 
 FROM PC
12. SELECT AVG(speed) 
 FROM Laptop WHERE price > 1000
13. SELECT AVG(speed)
FROM Product INNER JOIN PC
ON Product.model = PC.model WHERE Product.maker = 'A'
14. SELECT Classes.class, Ships.name, Classes.country
FROM Classes INNER JOIN Ships 
ON Classes.class= Ships.class WHERE Classes.numGuns >= 10
15. SELECT hd FROM PC 
GROUP BY (hd) 
HAVING COUNT(model) >= 2
16. SELECT DISTINCT p1.model, p2.model, p1.speed, p1.ram
FROM PC as p1, PC as p2
WHERE p1.speed = p2.speed and p1.ram = p2.ram and p1.model > p2.model
17. SELECT DISTINCT Product.type, Laptop.model, Laptop.speed
FROM Product, Laptop, PC
WHERE Laptop.speed < (SELECT MIN (speed) FROM PC) AND 
                      Product.type = 'laptop'
18. SELECT DISTINCT Product.maker, Printer.price
FROM Product INNER JOIN Printer
ON product.model = printer.model
WHERE (Printer.price = (SELECT MIN (price) FROM Printer WHERE Printer.color = 'y')) AND Printer.color = 'y'
19. SELECT Product.maker, AVG(screen) AS Avg_screen
FROM Product, Laptop
WHERE Product.model = Laptop.model
GROUP BY Product.maker
20. SELECT maker, COUNT(model)
FROM Product
WHERE type = 'pc'
GROUP BY (maker) 
HAVING COUNT(DISTINCT model) >= 3
21. SELECT Product.maker, MAX(PC.price)
FROM Product INNER JOIN PC
ON product.model = pc.model
GROUP BY (maker)
22. SELECT speed, AVG(price)
FROM PC
WHERE speed > 600
GROUP BY (speed)
23. SELECT maker
FROM Product, PC
WHERE (Product.model = PC.model AND PC.speed>=750)
INTERSECT
SELECT maker
FROM Product, Laptop
WHERE (Product.model = Laptop.model AND Laptop.speed>=750)
24. WITH allpr AS 
(SELECT model, price 
 FROM pc 
 WHERE price = 
  (SELECT MAX(price) 
   FROM pc)
UNION
SELECT model, price 
FROM laptop 
WHERE price = 
(SELECT MAX(price) 
FROM laptop)
UNION
SELECT model, price 
FROM printer 
WHERE price = 
(SELECT MAX(price) 
FROM printer))
SELECT model
FROM allpr 
WHERE price = 
(SELECT MAX(price) 
FROM allpr )
25. SELECT DISTINCT Product.maker 
FROM product INNER JOIN PC
ON Product.model = pc.model 
WHERE PC.ram = (select min(ram) from PC) 
and PC.speed = (SELECT MAX(speed) 
FROM PC WHERE ram = (SELECT MIN(ram) FROM PC))
                    and Product.maker in 
                    (SELECT maker 
                     FROM product 
                     WHERE type = 'printer')
26. WITH allpr AS 
(SELECT PC.model, PC.price,  Product.maker
 FROM PC INNER JOIN Product 
 ON PC.model = Product.model 
 WHERE Product.maker = 'A'
UNION ALL
SELECT Laptop.model, Laptop.price, Product.maker
FROM Laptop INNER JOIN Product  
ON Laptop.model = Product.model 
WHERE Product.maker = 'A'
)
SELECT AVG(price)
FROM allpr
27. SELECT Product.maker, AVG(PC.hd)
FROM Product INNER JOIN PC
ON product.model = pc.model
WHERE Product.maker in 
(SELECT maker 
FROM product 
 WHERE type = 'printer')
GROUP BY (maker)
28. SELECT COUNT(maker) FROM Product 
WHERE maker IN
(
  SELECT maker FROM Product
  GROUP BY maker
  HAVING COUNT(model) = 1
)
29. select t.point, t.date, SUM(t.inc), sum(t.out) 
from(select point, date, inc, null as out from Income_o  
Union 
select point, date, null as inc, Outcome_o.out from Outcome_o) 
as t group by t.point, t.date
30. with i as (
select point, date, sum(inc) as inc
from Income
group by point, date
),
 o as (
select point, date, sum(out) as out
from Outcome
group by point, date
)
select i.point, i.date, o.out, i.inc
from i left join o on i.point = o.point and i.date = o.date
union
select o.point, o.date, o.out, i.inc
from i right join o on i.point = o.point and i.date = o.date
31. SELECT class, country
FROM Classes
WHERE bore >= 16
32. SELECT res.country, cast(avg(power(res.bore,3)/2) as numeric(6,2)) as weight
From (SELECT Classes.country, Classes.bore, Ships.name
	FROM Classes JOIN Ships 
        ON Classes.class=Ships.class
	Union
	SELECT Classes.country, Classes.bore, Outcomes.ship AS name
	FROM Classes JOIN Outcomes 
        ON Classes.class=Outcomes.ship) AS res
GROUP BY res.country
33. SELECT ship
FROM Outcomes
WHERE result = 'sunk' AND battle = 'North Atlantic'
34. SELECT Ships.name
FROM Classes INNER JOIN Ships
ON Classes.class = Ships.class
WHERE Classes.type = 'bb' AND Ships.launched >= 1922 AND Classes.displacement > 35000
35. SELECT model, type 
FROM Product 
WHERE UPPER(model) NOT LIKE '%[^A-Z]%' 
OR model NOT LIKE '%[^0-9]%'
36. SELECT name
FROM Ships
Where class = name
UNION
SELECT Outcomes.ship 
FROM Outcomes, Classes 
Where Outcomes.ship = Classes.class
37. SELECT Classes.class
FROM Classes JOIN
     (SELECT name, class FROM Ships
      UNION
      SELECT ship, ship FROM Outcomes) AS res
ON Classes.class = res.class
GROUP BY Classes.class
HAVING COUNT(res.name) = 1
38. SELECT DISTINCT country FROM Classes 
WHERE country IN
(
  SELECT country FROM Classes 
  WHERE type = 'bb'
  INTERSECT
  SELECT country FROM Classes 
  WHERE type = 'bc'
)
39. SELECT DISTINCT o2.ship
FROM Battles as b1 JOIN Outcomes o1 ON o1.battle = b1.name,
     Battles as b2 JOIN Outcomes o2 ON o2.battle = b2.name
WHERE b1.date < b2.date 
  AND o1.result = 'damaged'
  AND o1.ship = o2.ship
40. SELECT maker, MAX(TYPE)
FROM product
GROUP BY maker
HAVING COUNT (model)> 1 AND MAX(TYPE)=MIN(TYPE)
41. SELECT Product.maker,
CASE WHEN MAX(CASE WHEN x.price IS NULL THEN 1 ELSE 0 END) = 0 
THEN MAX(x.price) ELSE NULL END
FROM Product JOIN (SELECT model, price FROM PC
                   UNION
                   SELECT model, price FROM Laptop
                   UNION 
                   SELECT model, price FROM Printer) AS x
ON Product.model = x.model
GROUP BY Product.maker
42. SELECT ship, battle
FROM Outcomes
WHERE result = 'sunk'
43. SELECT name FROM Battles
WHERE DATEPART(year, date) NOT IN
(SELECT launched from Ships
 WHERE launched IS NOT NULL)
44. SELECT name
FROM Ships
WHERE UPPER(name) LIKE 'R%'
UNION
SELECT ship
FROM Outcomes 
WHERE UPPER(ship) LIKE 'R%'
45. SELECT name FROM Ships
WHERE name LIKE '% % %'
UNION
SELECT ship FROM Outcomes
WHERE ship LIKE '% % %'
46. SELECT Outcomes.ship, displacement, numGuns 
FROM (
	SELECT name AS ship, displacement, numGuns 
	FROM Ships JOIN Classes ON Classes.class=Ships.class 
	UNION 
	SELECT class AS ship, displacement, numGuns 
	FROM Classes
) AS a RIGHT JOIN Outcomes  ON Outcomes.ship=a.ship 
WHERE battle = 'Guadalcanal'
47. WITH t1 AS 
(SELECT COUNT(name) as co, country 
FROM
(SELECT name, country 
 FROM Classes INNER JOIN Ships 
 ON Ships.class = Classes.class
      UNION
 SELECT ship, country 
 FROM Classes INNER JOIN Outcomes 
 ON Outcomes.ship = Classes.class) x1
GROUP BY country
),
t2 AS ( 
SELECT COUNT(name) as co, country 
FROM 
 ( SELECT name, country 
   FROM Classes INNER JOIN Ships 
   ON Ships.class = Classes.class
   WHERE name IN 
     (SELECT DISTINCT ship 
      FROM Outcomes 
      WHERE result LIKE 'sunk')
   UNION
   SELECT ship, country 
   FROM Classes INNER JOIN Outcomes 
   ON Outcomes.ship = Classes.class
   WHERE ship IN 
     (SELECT DISTINCT ship 
      FROM Outcomes 
      WHERE result LIKE 'sunk')) x2
GROUP BY country )
SELECT t1.country 
FROM t1 INNER JOIN t2
ON t1.co = t2.co 
and t1.country = t2.country
48. Select Ships.class
From Ships INNER JOIN Outcomes 
ON Outcomes.ship = Ships.name 
WHERE Outcomes.result = 'sunk'
Union
Select Classes.class
From Classes INNER JOIN Outcomes 
ON Outcomes.ship = Classes.class 
WHERE Outcomes.result = 'sunk'
49. SELECT Ships.name
FROM Classes INNER JOIN Ships
ON Ships.class = Classes.class
WHERE bore = 16
UNION
SELECT Outcomes.ship
FROM Classes INNER JOIN Outcomes 
ON Outcomes.ship = Classes.class
WHERE bore = 16
50. SELECT DISTINCT battle 
FROM Outcomes
JOIN Ships ON Outcomes.ship=Ships.name
WHERE Ships.class='Kongo'
51. WITH sh AS (
  SELECT name, class FROM ships
  UNION
  SELECT ship, ship FROM outcomes
)
SELECT 
  name
  FROM sh JOIN Classes c on sh.class=c.class
  WHERE numguns >= ALL(
    SELECT ci.numguns FROM Classes ci
    WHERE ci.displacement=c.displacement
      AND ci.class IN (SELECT sh.class FROM sh)
    )
52. WITH sh AS (
  SELECT name, class FROM ships
  UNION
  SELECT ship, ship FROM outcomes
)
SELECT 
  name
  FROM sh JOIN Classes c on sh.class=c.class
  WHERE country = 'Japan' 
    AND type = 'bb' 
    AND (displacement <= 65000 
      OR displacement  IS NULL) 
    AND (bore < 19 
      OR bore IS NULL) 
    AND (numGuns >= 9 
      OR numGuns IS NULL)
53. SELECT cast(avg(numGuns*1.0) as numeric(6,2)) 
  FROM Classes 
  WHERE type = 'bb'
54. WITH sh AS (
  SELECT name, class FROM ships
  UNION
  SELECT ship, ship FROM outcomes
)
SELECT 
  cast(avg(numGuns*1.0) as numeric(6,2)) 
  FROM sh JOIN Classes c on sh.class=c.class
WHERE type = 'bb'
55. WITH sh AS (
  SELECT name, class, launched FROM ships
)
SELECT 
  c.class, MIN(launched)
  FROM sh FULL JOIN Classes c on sh.class=c.class
  GROUP BY c.class
56. select class, SUM(CASE WHEN result='sunk' THEN 1 ELSE 0 END)
  from ( 
    select classes.class, name from classes
      left join ships on classes.class=ships.class
    union
    select class, ship from classes
      join outcomes on class=ship
  ) as sh
  left join outcomes on sh.name=outcomes.ship
  group by class
57. select class, SUM(CASE WHEN result='sunk' THEN 1 ELSE 0 END)
  from ( 
    select classes.class, name from classes
      left join ships on classes.class=ships.class
    union
    select class, ship from classes
      join outcomes on class=ship
  ) as sh
  left join outcomes on sh.name=outcomes.ship
  group by class

  having
    SUM(CASE WHEN result='sunk' THEN 1 ELSE 0 END) > 0
    and (select count(si.name)
         from (
            select ships.name, ships.class from ships
            union
            select outcomes.ship, outcomes.ship from outcomes) as si

        where si.class = sh.class
        group by si.class) >= 3
58. select distinct
  maker, type, cast((
      count(model) over(partition by maker, type))*100.0/
      count(model) over(partition by maker)
     as NUMERIC(5,2))     
  from (
    select
      pt.maker, pt.type, p.model
      from (   
        select distinct a.maker, b.type
        from product a, product b
      ) pt     
      left join product p on pt.maker=p.maker and pt.type=p.type
  )as p
59. select A.point, 
       case when o is null then i 
            else i - o 
            end 
FROM  (select point, sum(inc) as i 
       from Income_o 
       group by point) as A 
left join (select point, sum(out) as o
           from Outcome_o 
           group by point) as B 
on A.point=B.point
60.select A.point, 
       case when o is null then i 
            else i - o 
            end 
FROM  (select point, sum(inc) as i 
       from Income_o 
       where date<'2001-04-15'
       group by point) as A 
left join (select point, sum(out) as o
           from Outcome_o
           where date<'2001-04-15'
           group by point) as B 
on A.point=B.point
61.SELECT SUM(res.rest) FROM
(select A.point, 
       case when o is null then i 
            else i - o 
            end 
       as rest
FROM  (select point, sum(inc) as i 
       from Income_o 
       group by point) as A 
left join (select point, sum(out) as o
           from Outcome_o
           group by point) as B 
on A.point=B.point) res
62.SELECT SUM(res.rest) FROM
(select A.point, 
       case when o is null then i 
            else i - o 
            end 
       as rest
FROM  (select point, sum(inc) as i 
       from Income_o 
       where date<'2001-04-15'
       group by point) as A 
left join (select point, sum(out) as o
           from Outcome_o
           where date<'2001-04-15'
           group by point) as B 
on A.point=B.point) res
63.select name from passenger
where id_psg in (
  select p.id_psg
  from pass_in_trip p
  group by p.id_psg, p.place
  having count(place) > 1)
64.Select income.point, income.date, 'inc', sum(income.inc) 
from income 
left join outcome
on income.point=outcome.point and income.date=outcome.date 
where outcome.date is null  
group by income.point, income.date 

union 

Select outcome.point, outcome.date, 'out', sum(outcome.out) 
from income 
right join outcome 
on income.point=outcome.point and income.date=outcome.date 
where income.date is null 
group by outcome.point, outcome.date
65.select row_number() over (order by maker) num, maker2 maker, type 
from
(select maker, maker2 =
                 case row_number() over (partition by maker 
                                         order by CASE
                                                  WHEN type = 'PC' THEN 1
                                                  WHEN type = 'Laptop' THEN 2
                                                  WHEN type = 'Printer' THEN 3
                                                  ELSE 4
                                                  END)

                                          when 1 then maker
                                          else ''
                                          end
              , type
from (select distinct maker, type
      from product) x) y
66.SELECT date, max(c) FROM
(SELECT date,count(*) AS c FROM Trip,
(SELECT trip_no,date FROM Pass_in_trip WHERE date>='2003-04-01' AND date<='2003-04-07' GROUP BY trip_no, date) AS t1
WHERE Trip.trip_no=t1.trip_no AND town_from='Rostov'
GROUP BY date
UNION ALL
SELECT '2003-04-01',0
UNION ALL
SELECT '2003-04-02',0
UNION ALL
SELECT '2003-04-03',0
UNION ALL
SELECT '2003-04-04',0
UNION ALL
SELECT '2003-04-05',0
UNION ALL
SELECT '2003-04-06',0
UNION ALL
SELECT '2003-04-07',0) AS t2
GROUP BY date
67.with q as (
  select count(*) as c
  from trip
  group by town_from, town_to
)
select count(*) 
from q
where c= (select max(c) 
          from q)
68.with q as (
  select
    count(*) as c
    from trip
  group by
    case when town_from > town_to
          then town_from else town_to
    end
    ,case when town_from < town_to
          then town_from else town_to
    end
)
select count(*) 
from q
where c=(select max(c) from q)
69.WITH op as 
(select point, date, Inc as sm 
 FROM Income
union all
SELECT point, date, -Out 
FROM Outcome)

select point, convert(char(25),date,103),
(SELECT SUM(sm) 
 FROM op
 WHERE op.date<=o1.date 
   and op.point=o1.point) 
FROM op as o1
GROUP BY point, date
70.SELECT DISTINCT o.battle
FROM outcomes o
LEFT JOIN ships s 
ON s.name = o.ship
LEFT JOIN classes c 
ON o.ship = c.class 
OR s.class = c.class
WHERE c.country IS NOT NULL
GROUP BY c.country, o.battle
HAVING COUNT(o.ship) >= 3
71.select p.maker from product p
where p.type='pc' 
group by p.maker 
having count(DISTINCT p.model) = (select count(DISTINCT pc.model) 
from pc 
where pc.model in (select DISTINCT pr.model 
                   from product pr 
                   where pr.maker=p.maker))
72.SELECT
 (SELECT name FROM Passenger 
  WHERE ID_psg = B.ID_psg) AS name, B.trip_Qty
FROM (SELECT P.ID_psg, MIN(T.ID_comp) AS ID_comp,
             COUNT(*) AS trip_Qty, MAX(COUNT(*)) OVER() AS Max_Qty
      FROM Pass_in_trip AS P 
      JOIN
      Trip AS T 
      ON P.trip_no = T.trip_no
      GROUP BY P.ID_psg
      HAVING MIN(T.ID_comp) = MAX(T.ID_comp)
      ) AS B
WHERE B.trip_Qty = B.Max_Qty
73.SELECT DISTINCT c.country, b.name
FROM battles b, classes c
EXCEPT
SELECT c.country, o.battle
FROM outcomes o
LEFT JOIN ships s 
ON s.name = o.ship
LEFT JOIN classes c 
ON o.ship = c.class 
OR s.class = c.class
WHERE c.country IS NOT NULL
GROUP BY c.country, o.battle
74.select c.country, c.class 
from classes c 
where c.country like (case when (select count(*) 
                                 from classes c
                                 where c.country='Russia'
                                 group by c.country) is not null 
                            THEN ('Russia') 
                            else ('%') end)
75.select maker, max(l.price) as laptop, max(pc.price) as pc, max(pr.price) as printer
from laptop l 
right join 
product p 
on l.model = p.model
left join pc
on pc.model = p.model 
left join 
printer pr 
on p.model = pr.model
where maker in (
  select maker 
  from product 
  where model in (
    select model 
    from pc 
    where price is not null 
    union all
    select model 
    from printer 
    where price is not null 
    union all
    select model 
    from laptop 
    where price is not null)) 
group by maker order by maker
76.WITH cte AS
(SELECT ROW_NUMBER() 
 OVER (PARTITION BY ps.ID_psg,pit.place 
       ORDER BY pit.date) AS rowNumber
,DATEDIFF (minute, time_out, DATEADD(DAY,IIF(time_in<time_out,1,0), time_in)) AS timeFlight, ps.Id_psg, ps.name

FROM Pass_in_trip pit 
LEFT JOIN 
trip tr 
ON pit.trip_no = tr.trip_no
LEFT JOIN 
Passenger ps 
ON ps.ID_psg = pit.ID_psg 
)
SELECT MAX(cte.name), SUM(timeFlight) 
FROM cte
GROUP BY cte.ID_psg
HAVING MAX(rowNumber) = 1
77.with q as (
select
  count(distinct t.trip_no) as trip_count
  , pt.date
from trip t, pass_in_trip pt
where t.trip_no=pt.trip_no
      and town_from='Rostov'
group by date
)
select
  trip_count, date
  from q
  where trip_count=(select max(trip_count) from q)
78.select name
  , DATEADD(day, 1, EOMONTH(DATEADD(month, -1, date))) first_day
  , EOMONTH(date) last_day
from battles
79.SELECT Passenger.name, A.minutes
FROM (SELECT P.ID_psg,
      SUM((DATEDIFF(minute, time_out, time_in) + 1440)%1440) AS minutes,
      MAX(SUM((DATEDIFF(minute, time_out, time_in) + 1440)%1440)) OVER() AS MaxMinutes
      FROM Pass_in_trip P 
      JOIN
      Trip AS T 
      ON P.trip_no = T.trip_no
      GROUP BY P.ID_psg
      ) AS A 
JOIN
Passenger 
ON Passenger.ID_psg = A.ID_psg
WHERE A.minutes = A.MaxMinutes
80.select maker from product
except
select maker from product
where type='pc' and model not in (select model from pc)
81.with q as(
  select *, sum(out) over(
        partition by year(date), month(date)) as month_out
  from Outcome 
)
select code, point, date, out 
from q
where month_out = (select max(month_out) 
                   from q)
82.WITH CTE
AS
(SELECT PC.code, PC.price, number = ROW_NUMBER() OVER (ORDER BY PC.code)
FROM PC)
SELECT CTE.code, AVG(C.price)
FROM CTE
JOIN CTE C 
ON (C.number-CTE.number) < 6 
AND (C.number-CTE.number) >= 0
GROUP BY CTE.number, CTE.code
HAVING COUNT(CTE.number)=6
83.with q as (
  select
    name
    , case numGuns when 8 then 1 else 0 end as a
    , case bore when 15 then 1 else 0 end as c
    , case displacement when 32000 then 1 else 0 end as b
    , case type when 'bb' then 1 else 0 end as d
    , case launched when 1915 then 1 else 0 end as e
    , case c.class when 'Kongo' then 1 else 0 end as f
    , case country when 'USA' then 1 else 0 end as g
  from ships s, classes c where s.class=c.class
)
select name from q where (a+b+c+d+e+f+g)>=4
84.SELECT C.name, A.N_1_10, A.N_11_21, A.N_21_30
FROM (SELECT T.ID_comp,
       SUM(CASE WHEN DAY(P.date) < 11 THEN 1 ELSE 0 END) AS N_1_10,
       SUM(CASE WHEN (DAY(P.date) > 10 AND DAY(P.date) < 21) THEN 1 ELSE 0 END) AS N_11_21,
       SUM(CASE WHEN DAY(P.date) > 20 THEN 1 ELSE 0 END) AS N_21_30
      FROM Trip AS T JOIN
       Pass_in_trip AS P ON T.trip_no = P.trip_no AND CONVERT(char(6), P.date, 112) = '200304'
      GROUP BY T.ID_comp
      ) AS A JOIN
 Company AS C ON A.ID_comp = C.ID_comp
85.select maker from product where type='printer'
except
select maker from product where type!='printer'
union (
  select maker from product where type='pc'
  group by maker
  having count(model) >= 3
  except
  select maker from product where type!='pc'
)
86.SELECT maker, 
CASE count(distinct type) 
WHEN 1 THEN MIN(type) 
WHEN 2 THEN MIN(type) + '/' + MAX(type) 
WHEN 3 THEN 'Laptop/PC/Printer' END 
FROM Product 
GROUP BY maker
87.SELECT DISTINCT name, COUNT(town_to) Qty
FROM Trip tr JOIN Pass_in_trip pit ON tr.trip_no = pit.trip_no JOIN
         Passenger psg ON pit.ID_psg = psg.ID_psg
WHERE town_to = 'Moscow' AND pit.ID_psg NOT IN(SELECT DISTINCT ID_psg
FROM Trip tr JOIN Pass_in_trip pit ON tr.trip_no = pit.trip_no
WHERE date+time_out = (SELECT MIN (date+time_out)
                       FROM Trip tr1 JOIN Pass_in_trip pit1 ON tr1.trip_no = pit1.trip_no
                       WHERE pit.ID_psg = pit1.ID_psg)
AND town_from = 'Moscow')
GROUP BY pit.ID_psg, name
HAVING COUNT(town_to) > 1
88.SELECT (
	SELECT name FROM Passenger 
	WHERE ID_psg = R.ID_psg
) AS name, R.trip_Qty, (
	SELECT name FROM Company 
	WHERE ID_comp = R.ID_comp
) AS Company 
FROM (
	SELECT Pass_in_trip.ID_psg, MIN(Trip.ID_comp) AS ID_comp, 
	COUNT(*) AS trip_Qty, MAX(COUNT(*)) OVER() AS Max_Qty 
	FROM Pass_in_trip 
	INNER JOIN Trip ON Pass_in_trip.trip_no = Trip.trip_no 
	GROUP BY Pass_in_trip.ID_psg 
	HAVING MIN(Trip.ID_comp) = MAX(Trip.ID_comp) 
) AS R 
WHERE R.trip_Qty = R.Max_Qty
89.With sr as (select count(model) qty from Product Group by maker)

Select maker, count(model) qty from Product
Group by maker
Having count(model) = (select MAX(qty) from sr)
	or
count(model) = (select MIN(qty) from sr)
90.SELECT maker, model, type FROM
(
	SELECT maker, model, type,
	row_number() over(ORDER BY model) first,
	row_number() over(ORDER BY model DESC) second
	FROM Product
) R
WHERE first > 3 AND second > 3
91.SELECT CAST(sum(T.s)/count (T.s) AS NUMERIC(12,2)) 
FROM
(SELECT distinct q.Q_NAME, SUM (cast(ISNULL(B_VOL,0) as FLOAT)) as s 
FROM utQ q
LEFT JOIN utB B
on q.Q_ID=B.B_Q_ID
group by q.Q_NAME) T
92.SELECT Q_NAME
FROM utQ
WHERE Q_ID IN (SELECT DISTINCT B.B_Q_ID
                FROM (SELECT B_Q_ID
                        FROM utB
                        GROUP BY B_Q_ID
                        HAVING SUM(B_VOL) = 3 * 255) AS B
                WHERE B.B_Q_ID NOT IN (SELECT B_Q_ID
                                        FROM utB
                                        WHERE B_V_ID IN (SELECT B_V_ID
                                                          FROM utB
                                                          GROUP BY B_V_ID
                                                          HAVING SUM(B_VOL) < 255)))
93.select c.name, sum(vr.vr)
from
(select distinct t.id_comp, pt.trip_no, pt.date,t.time_out,t.time_in,--pt.id_psg,
case
     when DATEDIFF(mi, t.time_out,t.time_in)> 0 then DATEDIFF(mi, t.time_out,t.time_in)
     when DATEDIFF(mi, t.time_out,t.time_in)<=0 then DATEDIFF(mi, t.time_out,t.time_in+1)
end vr
from pass_in_trip pt left join trip t on pt.trip_no=t.trip_no
) vr left join company c on vr.id_comp=c.id_comp
group by c.name
94.SELECT DATEADD(day, S.Num, D.date) AS Dt,
       (SELECT COUNT(DISTINCT P.trip_no)
        FROM Pass_in_trip P
               JOIN Trip T
                 ON P.trip_no = T.trip_no
                    AND T.town_from = 'Rostov'
                    AND P.date = DATEADD(day, S.Num, D.date)) AS Qty
FROM (SELECT (3 * ( x - 1 ) + y - 1) AS Num
        FROM (SELECT 1 AS x UNION ALL SELECT 2 UNION ALL SELECT 3) AS N1
               CROSS JOIN (SELECT 1 AS y UNION ALL SELECT 2 UNION ALL SELECT 3) AS N2
        WHERE (3 * ( x - 1 ) + y ) < 8) AS S,
       (SELECT MIN(A.date) AS date
        FROM (SELECT P.date,
                       COUNT(DISTINCT P.trip_no) AS Qty,
                       MAX(COUNT(DISTINCT P.trip_no)) OVER() AS M_Qty
                FROM Pass_in_trip AS P
                       JOIN Trip AS T
                         ON P.trip_no = T.trip_no
                            AND T.town_from = 'Rostov'
                GROUP BY P.date) AS A
        WHERE A.Qty = A.M_Qty) AS D
95.Select 
	Company.name, 
	COUNT(DISTINCT CONVERT(CHAR(24),pt.date)+CONVERT(CHAR(4),t.trip_no)) flights, 
	count(distinct t.plane) planes,
	count(distinct pt.ID_psg) diff_psngrs,
	count(pt.ID_psg) total_psngrs
From
	Company
	Join Trip t On Company.ID_comp=t.ID_comp
	Join Pass_in_Trip pt On pt.trip_no=t.trip_no
Group by Company.name
96.with r as (select v.v_name,
       v.v_id,
       count(case when v_color = 'R' then 1 end) over(partition by v_id) cnt_r,
       count(case when v_color = 'B' then 1 end) over(partition by b_q_id) cnt_b
  from utV v join utB b on v.v_id = b.b_v_id)
select v_name
  from r
where cnt_r > 1
  and cnt_b > 0
group by v_name
97.select code, speed, ram, price, screen
from laptop where exists (
  select 1 x
  from (
    select v, rank()over(order by v) rn
    from ( select cast(speed as float) sp, cast(ram as float) rm,
                  cast(price as float) pr, cast(screen as float) sc
    )l unpivot(v for c in (sp, rm, pr, sc))u
  )l pivot(max(v) for rn in ([1],[2],[3],[4]))p
  where [1]*2 <= [2] and [2]*2 <= [3] and [3]*2 <= [4]
)
98.with CTE AS
(select 1 n, cast (0 as varchar(16)) bit_or, code, speed, ram 
FROM PC
UNION ALL
select n*2,
cast (convert(bit,(speed|ram)&n) as varchar(1))+cast(bit_or as varchar(15))
, code, speed, ram
from CTE where n < 65536
)
select code, speed, ram from CTE
where n = 65536
and CHARINDEX('1111', bit_or )> 0
99.with xuy as (select point, date, case when out is null then date else dateadd(dd, case when datename(dw,dateadd(dd, 1, date))='sunday' then 2 else 1 end, date) end date2 from (Select a.*, b.out from income_o a left join outcome_o b on a.point=b.point and a.date=b.date)aa)

select xuy.point, xuy.date, xuy.date2 from xuy
except
select xuy.point, xuy.date, xuy.date2 from xuy,outcome_o where outcome_o.point=xuy.point and xuy.date2=outcome_o.date
union
select xuy.point,xuy.date, (select dateadd(dd,case when datename(dw,min(date))='saturday' then 2 else 1 end,min(date)) from (select point, date from outcome_o where concat(point, ' ',dateadd(dd,case when datename(dw,date)='saturday' then 2 else 1 end,date)) not in (select concat (point,' ',date) from outcome_o))nn where date>=xuy.date2 and point=xuy.point) from xuy,outcome_o where outcome_o.point=xuy.point and xuy.date2=outcome_o.date
100.Select distinct A.date , A.R, B.point, B.inc, C.point, C.out
From (Select distinct date, ROW_Number() OVER(PARTITION BY date ORDER BY code asc) as R From Income
Union Select distinct date, ROW_Number() OVER(PARTITION BY date ORDER BY code asc) From Outcome) A
LEFT Join (Select date, point, inc
                , ROW_Number() OVER(PARTITION BY date ORDER BY code asc) as RI FROM Income
           ) B on B.date=A.date and B.RI=A.R
LEFT Join (Select date, point, out
                , ROW_Number() OVER(PARTITION BY date ORDER BY code asc) as RO FROM Outcome
           ) C on C.date=A.date and C.RO=A.R
101.SELECT code, model, color, type, price,
  MAX(model)OVER(PARTITION BY Grp)max_model,
  MAX(CASE type WHEN'Laser'THEN 1 ELSE 0 END)OVER(PARTITION BY Grp)+
  MAX(CASE type WHEN'Matrix'THEN 1 ELSE 0 END)OVER(PARTITION BY Grp)+
  MAX(CASE type WHEN'Jet'THEN 1 ELSE 0 END)OVER(PARTITION BY Grp)distinct_types,
  AVG(price)OVER(PARTITION BY Grp)
FROM(
  SELECT *,
    CASE color WHEN'n'THEN 0 ELSE ROW_NUMBER()OVER(ORDER BY code)END+
    CASE color WHEN'n'THEN 1 ELSE-1 END*ROW_NUMBER()OVER(PARTITION BY color ORDER BY code)Grp
  FROM Printer
)T
102.select name from passenger
where id_psg in
(
select id_psg from trip t,pass_in_trip pit
where t.trip_no=pit.trip_no
group by id_psg
having count(distinct case when town_from<=town_to then town_from+town_to else town_to+town_from end)=1
)
103.select
	min(t1.trip_no) min1, min(t2.trip_no) min2, min(t3.trip_no) min3,
	max(t1.trip_no) max, max(t2.trip_no) max2, max(t3.trip_no) max3
From
	Trip t1,
	Trip t2,
	Trip t3
Where t1.trip_no < t2.trip_no and t2.trip_no < t3.trip_no
104.